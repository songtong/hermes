
<div class="panel panel-info">
	<div class="panel-heading">
		<label class="label label-danger"> <span ng-bind="current_topic_type" style="text-transform: uppercase;"></span> TOPICS
		</label> <a ng-if="logined" href="#/add/{{current_topic_type}}/{{current_topic_type}}" class="btn btn-xs btn-success" style="text-align: center; float: right;"> <span class="glyphicon glyphicon-plus"></span> 新增
		</a>
	</div>
	<div class="panel-body" ng-if="current_topics.length == 0">
		<h2 style="text-align: center;">
			<label class="label label-danger">NO TOPIC WAS FOUND</label>
		</h2>
	</div>
	<table ng-if="current_topics.length > 0" class="table table-hover" st-safe-src="current_topics" st-pipe="current_topics" st-table="display_current_topics">
		<thead>
			<tr>
				<th>#</th>
				<th st-sort="name">名称</th>
				<th st-sort="codecType" width="100px" style="text-align: center;">编码</th>
				<th st-sort="getters.sort_partitions" width="60px" style="text-align: center;">分区</th>
				<th ng-if="current_topic_type == 'mysql'" st-sort="consumerRetryPolicy">消费策略</th>
				<th ng-if="current_topic_type == 'mysql'" st-sort="brokerGroup">Broker分组</th>
				<th ng-if="current_topic_type == 'mysql'" style="text-align: center">状态</th>
				<th ng-if="current_topic_type == 'kafka'" st-sort="endpointType">Endpoint</th>
				<th st-sort="schemaName">Schema名称</th>
				<th st-sort="endpointVersion">版本</th>
				<th></th>
			</tr>
			<tr>
				<th></th>
				<th><input st-search="name" placeholder="Topic" class="input-sm form-control" type="search" ng-model-options="{updateOn:'blur'}" /></th>
				<th><input st-search="codecType" placeholder="Codec" class="input-sm form-control" type="search" style="text-align: center;" ng-model-options="{updateOn:'blur'}" /></th>
				<th><input st-search="partitions" placeholder="Partitions" class="input-sm form-control" type="search" style="text-align: center;" ng-model-options="{updateOn:'blur'}" /></th>
				<th ng-if="current_topic_type == 'mysql'"><input st-search="consumerRetryPolicy" placeholder="Policy" class="input-sm form-control" type="search" ng-model-options="{updateOn:'blur'}" /></th>
				<th ng-if="current_topic_type == 'mysql'"><input st-search="brokerGroup" placeholder="Broker Group" class="input-sm form-control" type="search" ng-model-options="{updateOn:'blur'}" /></th>
				<th ng-if="current_topic_type == 'mysql'"></th>
				<th ng-if="current_topic_type == 'kafka'"><input st-search="endpointType" placeholder="Endpoint" class="input-sm form-control" type="search" ng-model-options="{updateOn:'blur'}" /></th>
				<th><input st-search="schemaName" placeholder="Name" class="input-sm form-control" type="search" ng-model-options="{updateOn:'blur'}" /></th>
				<th><input st-search="schemaVersion" placeholder="Version" class="input-sm form-control" type="search" ng-model-options="{updateOn:'blur'}" /></th>
				<th></th>
			</tr>
		</thead>
		<tbody ng-if="!is_loading">
			<tr ng-click="" ng-repeat="row in display_current_topics">
				<td><span ng-bind="$index + 1"> </span></td>
				<td><a href="#/detail/{{current_topic_type}}/{{current_topic_type}}/{{row.name}}" ng-bind="row.name|short:50" tooltip="{{row.name}}" tooltip="{{row.id}}" /></td>
				<td align="center"><span ng-bind="row.codecType"></span></td>
				<td align="center"><span ng-bind="row.partitions.length"></td>
				<td ng-if="current_topic_type == 'mysql'" style="width: 20%"><a href="" ng-bind="row.consumerRetryPolicy | short:20" tooltip="{{row.consumerRetryPolicy}}"></a></td>
				<td ng-if="current_topic_type == 'mysql'" style="width: 10%"><span ng-bind="row.brokerGroup"></span></td>
				<td ng-if="current_topic_type == 'mysql'" align="center" style="width: 5%"><span tooltip="Latest: {{row.latestProduced | date:'yyyy-MM-dd HH:mm:ss'}} Delay: {{row.totalDelay}}" class="status-ok" ng-if="cur_time-row.latestProduced&lt;noProduceLimit && row.totalDelay&lt;delayLimit"></span> <span tooltip="Latest: {{row.latestProduced | date:'yyyy-MM-dd HH:mm:ss'}} Delay: {{row.totalDelay}} " class="status-danger"
					ng-if="cur_time-row.latestProduced&lt;noProduceLimit && row.totalDelay&gt;=delayLimit"></span> <span tooltip="Latest: {{row.latestProduced | date:'yyyy-MM-dd HH:mm:ss'}} Delay: {{row.totalDelay}} " class="status-warn" ng-if="cur_time-row.latestProduced&gt;noProduceLimit"></span></td>
				<td ng-if="current_topic_type == 'kafka'"><span ng-bind="row.endpointType"></span></td>
				<td style="width: 20%"><a href="" ng-bind="row.schema.name | short:20" tooltip="{{row.schema.name}}"></a></td>
				<td><a href="" ng-bind="row.schema.version" ng-click="show_schema_view(row.schema)" tooltip="点击查看详情"></a></td>
				<td style="text-align: right;" class="col-md-3">
					<div ng-if="row.codecType == 'avro'&& environment =='FWS'" ng-click="set_selected(row)" data="schema_data" upload-button url="/api/schemas" tooltip="上传Schema文件" class="btn  btn-link btn-upload" on-success="upload_result(row, true, response)" on-error="upload_result(row, false, response)" style="padding: 1px 1px;">
						<span class="glyphicon glyphicon-upload"></span>
					</div>
					<div ng-if="row.schema != null && environment =='FWS'" ng-click="deploy_maven_row_selected(row)" data-toggle="modal" data-target="#upload-schema-view" class="btn  btn-link" tooltip="部署Schema Jar" style="padding: 1px 1px;">
						<span class="glyphicon glyphicon-flag" style="color: purple;"></span>
					</div>
					<div ng-if="row.schema != null && environment =='FWS'" ng-click="set_current_dependencyString(row.schema.dependencyString)" data-toggle="modal" data-target="#dependencyString-view" class="btn  btn-link" tooltip="查看maven依赖" style="padding: 1px 1px;">
						<span class="glyphicon glyphicon-zoom-in"></span>
					</div>
					<div ng-if="row.schema != null" class="btn  btn-link" tooltip="下载Schema Jar文件" style="padding: 1px 1px;">
						<a target="_self" href="/api/schemas/{{row.schema.id}}/jar"> <span class="glyphicon glyphicon-download" style="color: black;"></span>
						</a>
					</div>
					<div ng-if="row.schema != null" class="btn  btn-link" tooltip="下载Schema Cs文件" style="padding: 1px 1px;">
						<a target="_self" href="/api/schemas/{{row.schema.id}}/cs"> <span class="glyphicon glyphicon-download" style="color: green;"></span>
						</a>
					</div>
					<div ng-if="row.schema != null" class="btn btn-link" tooltip="下载Schema描述文件" style="padding: 1px 1px;">
						<a target="_self" href="/api/schemas/{{row.schema.id}}/schema"> <span class="glyphicon glyphicon-download" style="color: blue;"></span>
						</a>
					</div>
					<div ng-if="row.schema != null" class="btn btn-xs btn-link" ng-click="sync_schema(row)" tooltip="同步Schema" style="padding: 1px 1px;">
						<span class="glyphicon glyphicon-cloud" style="color: orange;"></span>
					</div> <!--  <div ng-if="current_topic_type == 'kafka'" ng-click="set_selected(row)" class="btn btn-xs btn-success btn-upload" data-toggle="modal" data-target="#upload-schema-view">
						<span class="glyphicon glyphicon-upload"></span>
					</div>-->
					<div class="btn-group" ng-if="logined">
						<button type="button" class="btn btn-xs btn-info dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
							操作 <span class="caret"></span>
						</button>
						<ul class="dropdown-menu dropdown-menu-right" role="group">
							<li><a ng-click="sync_topic(row)" href=""> <span class="glyphicon glyphicon-cloud" style="color: green"></span> 同步Topic
							</a></li>
							<li ng-if="row.schema != null"><a ng-click="delete_schema(row)" href=""> <span class="glyphicon glyphicon-remove" style="color: red;"></span> 删除Schema
							</a></li>
							<li><a ng-click="delete_topic(row, $index)" href=""> <span class="glyphicon glyphicon-remove" style="color: red;"></span> 删除Topic
							</a></li>
						</ul>
					</div>
				</td>
			</tr>
		</tbody>
		<tbody ng-if="is_loading">
			<tr>
				<td colspan="8" class="text-center">Loading ...</td>
			</tr>
		</tbody>
	</table>
</div>
<div class="modal fade" id="schema-view" tabindex="-1" role="dialog" aria-labelledby="schema-view-label" aria-hidden="true">
	<div class="modal-dialog" style="width: 1024px">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
				<h4 class="modal-title" id="schema-view-label">
					Schema ID: <span ng-bind="current_schema"></span>
				</h4>
			</div>
			<div class="modal-body">
				<div class="container-fluid">
					<div class="row">
						<div class="col-md-6">
							<h5>
								<label class="label label-primary">Schema结构</label>
							</h5>
							<div id="data-tree"></div>
						</div>
						<div class="col-md-6">
							<h5>
								<label class="label label-primary">Schema源文件</label>
							</h5>
							<pre style="max-height: 600px; overflow: scroll;">{{current_attr_json | json:2}}</pre>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
<div class="modal fade" id="dependencyString-view" tabindex="-1" role="dialog" aria-labelledby="dependencyString-view" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
				<h4 class="modal-title" id="schema-view-label">
					Maven依赖</span>
				</h4>
			</div>
			<div class="modal-body">
				<div class="container-fluid">
					<div class="row">
						<pre style="max-height: 600px; overflow: scroll;" ng-bind="current_dependencyString || '当前版本暂未部署'"></pre>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
<div class="modal fade" id="upload-schema-view" tabindex="-1" role="dialog" aria-labelledby="schema-view-label" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
				<h4 class="modal-title">部署schema</h4>
			</div>
			<div class="modal-body">
				<form class="form-horizontal">
					<div class="form-group">
						<label class="col-sm-3 control-label">Group</label>
						<div class="col-sm-6">
							<input type="text" class="form-control" ng-model="newSchema.groupId">
						</div>
					</div>
					<div class="form-group">
						<label class="col-sm-3 control-label">Artifact</label>
						<div class="col-sm-6">
							<input type="text" class="form-control" ng-model="newSchema.artifactId">
						</div>
					</div>
					<div class="form-group">
						<label class="col-sm-3 control-label">Repository</label>
						<div class="col-sm-6">
							<select class="form-control" ng-model="newSchema.repositoryId" ng-options="repositoryType for repositoryType in repositoryTypes"></select>
						</div>
					</div>
					<div class="form-group">
						<div class="col-sm-offset-3 col-sm-2">
							<button class="btn btn-success" ng-click="deploy_schema_to_maven()">部署</button>
						</div>
						<div>
							<p>{{prompt}}</p>
						</div>
					</div>
				</form>
			</div>
		</div>
	</div>
</div>